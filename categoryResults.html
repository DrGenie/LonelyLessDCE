<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results by Loneliness Category</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF CDN for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Additional styles specific to categoryResults.html */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        .category-section {
            margin-top: 40px;
            padding: 20px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .chart-container {
            width: 100%;
            height: 400px;
            margin-top: 20px;
        }
        .data-section {
            margin-top: 20px;
        }
        .data-section h3 {
            color: #2980b9;
            margin-bottom: 10px;
        }
        .data-section p, .data-section li {
            font-size: 1em;
            color: #34495e;
        }
        .data-section ul {
            list-style-type: disc;
            margin-left: 25px;
        }
        button {
            padding: 10px 15px;
            background-color: #27ae60;
            color: #ffffff;
            border: none;
            font-size: 1em;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 20px;
        }
        button:hover {
            background-color: #1e8449;
            transform: translateY(-2px);
        }
        footer {
            text-align: center;
            margin-top: 60px;
            padding: 20px;
            background-color: #3498db;
            color: #ffffff;
            font-size: 1.1em;
            border-radius: 0 0 12px 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Results by Loneliness Category</h1>

        <!-- Not Lonely Section -->
        <div class="category-section" id="notLonelySection">
            <h2>Not Lonely</h2>
            <div class="chart-container">
                <canvas id="notLonelyChart" aria-label="Doughnut chart showing uptake probability for Not Lonely category" role="img"></canvas>
            </div>
            <div class="data-section">
                <h3>Predicted Probability of Program Uptake:</h3>
                <p id="notLonelyProbability">--</p>
                <h3>Interpretation:</h3>
                <p id="notLonelyInterpretation">--</p>
                <h3>Your Selected Program Package:</h3>
                <ul id="notLonelyPackageList">
                    <!-- Selected attributes will be listed here -->
                </ul>
                <h3>Cost Analysis:</h3>
                <ul id="NotLonelyCostList">
                    <!-- Cost components will be listed here -->
                </ul>
                <p><strong>Total Estimated Cost:</strong> <span id="NotLonelyTotalCost">--</span> AUD</p>
                <h3>Benefit Analysis:</h3>
                <p><strong>Total Estimated Benefits:</strong> <span id="NotLonelyBenefits">--</span> AUD</p>
                <h3>Cost-Benefit Analysis:</h3>
                <p><strong>Net Benefit:</strong> <span id="NotLonelyNetBenefit">--</span> AUD</p>
                <p><strong>Benefit-Cost Ratio:</strong> <span id="NotLonelyBCR">--</span></p>
            </div>
            <div class="chart-container">
                <canvas id="notLonelyCBAChart" aria-label="Bar chart showing Cost-Benefit Analysis for Not Lonely category" role="img"></canvas>
            </div>
        </div>

        <!-- Moderately Lonely Section -->
        <div class="category-section" id="moderatelyLonelySection">
            <h2>Moderately Lonely</h2>
            <div class="chart-container">
                <canvas id="moderatelyLonelyChart" aria-label="Doughnut chart showing uptake probability for Moderately Lonely category" role="img"></canvas>
            </div>
            <div class="data-section">
                <h3>Predicted Probability of Program Uptake:</h3>
                <p id="moderatelyLonelyProbability">--</p>
                <h3>Interpretation:</h3>
                <p id="moderatelyLonelyInterpretation">--</p>
                <h3>Your Selected Program Package:</h3>
                <ul id="moderatelyLonelyPackageList">
                    <!-- Selected attributes will be listed here -->
                </ul>
                <h3>Cost Analysis:</h3>
                <ul id="ModeratelyLonelyCostList">
                    <!-- Cost components will be listed here -->
                </ul>
                <p><strong>Total Estimated Cost:</strong> <span id="ModeratelyLonelyTotalCost">--</span> AUD</p>
                <h3>Benefit Analysis:</h3>
                <p><strong>Total Estimated Benefits:</strong> <span id="ModeratelyLonelyBenefits">--</span> AUD</p>
                <h3>Cost-Benefit Analysis:</h3>
                <p><strong>Net Benefit:</strong> <span id="ModeratelyLonelyNetBenefit">--</span> AUD</p>
                <p><strong>Benefit-Cost Ratio:</strong> <span id="ModeratelyLonelyBCR">--</span></p>
            </div>
            <div class="chart-container">
                <canvas id="moderatelyLonelyCBAChart" aria-label="Bar chart showing Cost-Benefit Analysis for Moderately Lonely category" role="img"></canvas>
            </div>
        </div>

        <!-- Severely Lonely Section -->
        <div class="category-section" id="severelyLonelySection">
            <h2>Severely Lonely</h2>
            <div class="chart-container">
                <canvas id="severelyLonelyChart" aria-label="Doughnut chart showing uptake probability for Severely Lonely category" role="img"></canvas>
            </div>
            <div class="data-section">
                <h3>Predicted Probability of Program Uptake:</h3>
                <p id="severelyLonelyProbability">--</p>
                <h3>Interpretation:</h3>
                <p id="severelyLonelyInterpretation">--</p>
                <h3>Your Selected Program Package:</h3>
                <ul id="severelyLonelyPackageList">
                    <!-- Selected attributes will be listed here -->
                </ul>
                <h3>Cost Analysis:</h3>
                <ul id="SeverelyLonelyCostList">
                    <!-- Cost components will be listed here -->
                </ul>
                <p><strong>Total Estimated Cost:</strong> <span id="SeverelyLonelyTotalCost">--</span> AUD</p>
                <h3>Benefit Analysis:</h3>
                <p><strong>Total Estimated Benefits:</strong> <span id="SeverelyLonelyBenefits">--</span> AUD</p>
                <h3>Cost-Benefit Analysis:</h3>
                <p><strong>Net Benefit:</strong> <span id="SeverelyLonelyNetBenefit">--</span> AUD</p>
                <p><strong>Benefit-Cost Ratio:</strong> <span id="SeverelyLonelyBCR">--</span></p>
            </div>
            <div class="chart-container">
                <canvas id="severelyLonelyCBAChart" aria-label="Bar chart showing Cost-Benefit Analysis for Severely Lonely category" role="img"></canvas>
            </div>
        </div>

        <!-- Download All CBA Reports Button -->
        <button onclick="downloadAllCBAs()" aria-label="Download all Cost-Benefit Analysis reports as PDFs">Download All CBA Reports as PDFs</button>
    </div>

    <footer>
        <p>by Mesfin Genie, The University of Newcastle, Australia</p>
    </footer>

    <script>
        /* categoryResults.html Script */

        // Initialize Chart.js with Doughnut Chart for each category
        const charts = {};

        function initializeCharts() {
            const categories = ["NotLonely", "ModeratelyLonely", "SeverelyLonely"];

            categories.forEach(category => {
                // Uptake Probability Chart
                const ctx = document.getElementById(`${category}Chart`).getContext('2d');
                charts[`${category}Chart`] = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Uptake Probability', 'Remaining'],
                        datasets: [{
                            data: [0, 1],
                            backgroundColor: ['rgba(39, 174, 96, 0.6)', 'rgba(236, 240, 241, 0.3)'],
                            borderColor: ['rgba(39, 174, 96, 1)', 'rgba(236, 240, 241, 1)'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                        size: 14
                                    },
                                    color: '#34495e'
                                }
                            },
                            title: {
                                display: true,
                                text: `Predicted Probability of Program Uptake - ${category.replace(/([A-Z])/g, ' $1').trim()}`,
                                font: {
                                    size: 18
                                },
                                color: '#2c3e50'
                            }
                        }
                    }
                });

                // Cost-Benefit Analysis Chart
                const cbaCtx = document.getElementById(`${category}CBAChart`).getContext('2d');
                charts[`${category}CBAChart`] = new Chart(cbaCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Total Costs', 'Total Benefits'],
                        datasets: [{
                            label: 'Amount (AUD)',
                            data: [0, 0],
                            backgroundColor: [
                                'rgba(231, 76, 60, 0.6)', // Red for Costs
                                'rgba(39, 174, 96, 0.6)'   // Green for Benefits
                            ],
                            borderColor: [
                                'rgba(231, 76, 60, 1)',
                                'rgba(39, 174, 96, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: `Cost-Benefit Analysis - ${category.replace(/([A-Z])/g, ' $1').trim()}`,
                                font: {
                                    size: 18
                                },
                                color: '#2c3e50'
                            }
                        }
                    }
                });
            });
        }

        // Listen for postMessage events
        window.addEventListener('message', function(event) {
            // In production, verify the origin
            // if (event.origin !== "http://yourdomain.com") return;

            const data = event.data;
            if (typeof data !== 'object') return;

            // Assuming data has properties for each category
            // Example structure:
            // {
            //     NotLonely: { probability, interpretation, packageList, costList, totalCost, benefits, netBenefit, bcr },
            //     ModeratelyLonely: { ... },
            //     SeverelyLonely: { ... }
            // }

            for (let category in data) {
                if (!data.hasOwnProperty(category)) continue;

                const categoryData = data[category];
                populateCategoryData(category, categoryData);
            }
        });

        // Function to populate data for a specific category
        function populateCategoryData(category, data) {
            // Update Probability
            document.getElementById(`${category}Probability`).innerText = data.probability;

            // Update Interpretation
            document.getElementById(`${category}Interpretation`).innerHTML = data.interpretation;

            // Update Program Package
            document.getElementById(`${category}PackageList`).innerHTML = data.packageList;

            // Update Cost Analysis
            document.getElementById(`${category}CostList`).innerHTML = data.costList;

            // Update Total Cost
            document.getElementById(`${category}TotalCost`).innerText = data.totalCost;

            // Update Benefits
            document.getElementById(`${category}Benefits`).innerText = data.benefits;

            // Update Cost-Benefit Analysis
            document.getElementById(`${category}NetBenefit`).innerText = data.netBenefit;
            document.getElementById(`${category}BCR`).innerText = data.bcr;

            // Update Uptake Probability Chart
            charts[`${category}Chart`].data.datasets[0].data = [parseFloat(data.probability) / 100, 1 - (parseFloat(data.probability) / 100)];
            
            // Update Chart Colors based on probability
            const P_final = parseFloat(data.probability) / 100;
            if (P_final < 0.3) {
                charts[`${category}Chart`].data.datasets[0].backgroundColor = ['rgba(231, 76, 60, 0.6)', 'rgba(236, 240, 241, 0.3)'];
                charts[`${category}Chart`].data.datasets[0].borderColor = ['rgba(231, 76, 60, 1)', 'rgba(236, 240, 241, 1)'];
            } else if (P_final >= 0.3 && P_final < 0.7) {
                charts[`${category}Chart`].data.datasets[0].backgroundColor = ['rgba(241, 196, 15, 0.6)', 'rgba(236, 240, 241, 0.3)'];
                charts[`${category}Chart`].data.datasets[0].borderColor = ['rgba(241, 196, 15, 1)', 'rgba(236, 240, 241, 1)'];
            } else {
                charts[`${category}Chart`].data.datasets[0].backgroundColor = ['rgba(39, 174, 96, 0.6)', 'rgba(236, 240, 241, 0.3)'];
                charts[`${category}Chart`].data.datasets[0].borderColor = ['rgba(39, 174, 96, 1)', 'rgba(236, 240, 241, 1)'];
            }
            charts[`${category}Chart`].update();

            // Update Cost-Benefit Analysis Chart
            charts[`${category}CBAChart`].data.datasets[0].data = [parseFloat(data.totalCost.replace(/,/g, '')), parseFloat(data.benefits.replace(/,/g, ''))];
            charts[`${category}CBAChart`].update();
        }

        // Function to download all CBA reports as PDFs
        function downloadAllCBAs() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let yPosition = 10;

            const categories = ["NotLonely", "ModeratelyLonely", "SeverelyLonely"];

            categories.forEach((category, index) => {
                // Get data from the page
                const probability = document.getElementById(`${category}Probability`).innerText;
                const totalCost = document.getElementById(`${category}TotalCost`).innerText;
                const benefits = document.getElementById(`${category}Benefits`).innerText;
                const netBenefit = document.getElementById(`${category}NetBenefit`).innerText;
                const bcr = document.getElementById(`${category}BCR`).innerText;

                doc.setFontSize(16);
                doc.text(`Cost-Benefit Analysis Report - ${category.replace(/([A-Z])/g, ' $1').trim()}`, 10, yPosition);
                yPosition += 10;
                doc.setFontSize(12);
                doc.text(`Total Estimated Cost: $${totalCost} AUD`, 10, yPosition);
                yPosition += 10;
                doc.text(`Total Estimated Benefits: $${benefits} AUD`, 10, yPosition);
                yPosition += 10;
                doc.text(`Net Benefit: $${netBenefit} AUD`, 10, yPosition);
                yPosition += 10;
                doc.text(`Benefit-Cost Ratio: ${bcr}`, 10, yPosition);
                
                yPosition += 20;

                if (yPosition > 270 && index < categories.length - 1) { // Avoid adding a page after the last category
                    doc.addPage();
                    yPosition = 10;
                }
            });

            doc.save('All_CBA_Reports.pdf');

            alert("All Cost-Benefit Analysis reports downloaded successfully!");
        }
    </script>
</body>
</html>
